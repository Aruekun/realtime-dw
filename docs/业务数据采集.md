# Mysql的Binlog原理

在实时数仓业务数据采集、分析中，往往是通过采集Mysql数据库的Binlog到消息队列中进行实时分析。首先，我们介绍一下什么是Mysql的Binlog。

## 二进制日志(binlog)

MySQL的二进制日志可以说MySQL最重要的日志了，它记录了所有的 DDL 和DML(除了数据查询语句)语句，以事件形式记录，还包含语句所执行的消耗的时间，MySQL的二进制日志是事务安全型的。

的二进制日志是事务安全型的。

- binlog是记录所有**数据库表结构变更**（例如CREATE、ALTER TABLE…）以及**表数据修改**（INSERT、UPDATE、DELETE…）的二进制日志。

- **binlog不会记录SELECT和SHOW**这类操作，因为这类操作对数据本身并没有修改，但你可以通过查询通用日志来查看MySQL执行过的所有语句。

- 二进制日志包括两类文件：
  - `二进制日志索引文件`（文件名后缀为.index）用于记录所有的二进制文件
  - `二进制日志文件`（文件名后缀为.00000*）记录数据库所有的DDL和DML(除了数据查询语句)语句事件。



一般来说，开启二进制日志会有1%的性能损耗，二进制有两个最重要的使用场景: 

- 其一：MySQL Replication 在 Master 端开启 binlog，Master 把它的二进制日志

  传递给 slaves 来达到 master-slave 数据一致的目的。

- 其二：自然就是数据恢复了，通过使用 mysqlbinlog 工具来使恢复数据。

## binlog的开启

- 登录Mysql后使用下面的命令查看是否开启binlog

  ```sql
  show variables like 'log_%';
  ```

- 如果看到以下日志说明没有开启binlog

  ![image-20210329235403290](业务数据采集.assets/image-20210329235403290.png)

- 编辑配置文件

  ```shell
  vim /etc/my.cnf
  ```

- 配置文件中增加以下内容

  ```shell
  #binlog日志名称前缀
  log-bin=mysql-bin
  #默认值未0，如果使用默认值则不能和从节点通信，这个值的区间是：1到(2^32)-1
  server-id=1
  #行级,binlog 会记录每次操作后每行记录的变化
  binlog_format=ROW
  #设置binlog清理时间
  expire_logs_days=30
  ```

  

  

